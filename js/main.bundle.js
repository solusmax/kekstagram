(()=>{"use strict";const e=document.querySelector(".img-upload__preview img"),t=document.querySelector("#messages").content.querySelector(".img-upload__message"),r=t=>{e.src=t},o=document.querySelector("#error-alert").content.querySelector(".error-alert"),n=(e,t)=>e.length<=t,c=e=>"Escape"===e.key,l=(e,t)=>{const r=o.cloneNode(!0);r.querySelector(".error-alert__title").textContent=e,document.body.appendChild(r),t&&setTimeout((()=>{r.remove()}),t)},s=e=>{e.value=""};let i,a;const d=(e,t,r)=>{e.classList.remove("hidden"),document.body.classList.add("modal-open"),a=((e,t,r)=>o=>{c(o)&&!Q(o)&&(o.preventDefault(),u(e,t,r))})(e,t,r),i=((e,t,r)=>()=>{u(e,t,r)})(e,t,r),t.addEventListener("click",i),document.addEventListener("keydown",a)},u=(e,t,r)=>{e.classList.add("hidden"),document.body.classList.remove("modal-open"),t.removeEventListener("click",i),document.removeEventListener("keydown",a),"upload"===r&&Y()},m=document.querySelector(".img-upload__overlay"),p=m.querySelector(".img-upload__preview img"),y=m.querySelector(".scale__control--smaller"),v=m.querySelector(".scale__control--bigger"),S=m.querySelector(".scale__control--value");let f=1;const L=e=>{S.value=100*e+"%",p.style.transform=`scale(${e})`};y.addEventListener("click",(()=>{f>.25&&(f-=.25,L(f))})),v.addEventListener("click",(()=>{f<1&&(f+=.25,L(f))}));const g={ORIGINAL:{FILTER:"none"},CHROME:{FILTER:"grayscale",MIN:0,MAX:1,STEP:.1,DEFAULT_VALUE:1},SEPIA:{FILTER:"sepia",MIN:0,MAX:1,STEP:.1,DEFAULT_VALUE:1},MARVIN:{FILTER:"invert",UNIT:"%",MIN:0,MAX:100,STEP:1,DEFAULT_VALUE:100},PHOBOS:{FILTER:"blur",UNIT:"px",MIN:0,MAX:3,STEP:.1,DEFAULT_VALUE:3},HEAT:{FILTER:"brightness",MIN:1,MAX:3,STEP:.1,DEFAULT_VALUE:3}},E=document.querySelector(".img-upload__overlay"),q=E.querySelector(".img-upload__preview img"),h=E.querySelector(".effect-level"),k=h.querySelector(".effect-level__slider"),A=E.querySelectorAll(".effects__radio"),T=E.querySelector(".effect-level__value");let I;const U=()=>{k.noUiSlider&&k.noUiSlider.destroy(),h.classList.add("hidden")},C=()=>{q.classList.contains(I)&&q.classList.remove(I),q.style.filter=g.ORIGINAL.FILTER,T.value=null},x=e=>{const t=(e=>{const t=g[e.toUpperCase()];return{filterName:t.FILTER,unit:t.UNIT?t.UNIT:"",min:t.MIN,max:t.MAX,step:t.STEP,defaultValue:t.DEFAULT_VALUE}})(e);(e=>{I=(e=>`effects__preview--${e}`)(e),q.classList.add(I)})(e),(({min:e,max:t,step:r,defaultValue:o})=>{T.min=e,T.max=t,T.step=r,T.value=o})(t),(e=>{k.noUiSlider?((({min:e,max:t,step:r,defaultValue:o})=>{k.noUiSlider.updateOptions({range:{min:[e],max:[t]},step:r}),k.noUiSlider.set(o)})(e),k.noUiSlider.off("update")):(({min:e,max:t,step:r,defaultValue:o})=>{noUiSlider.create(k,{range:{min:[e],max:[t]},step:r,start:[o],connect:"lower"}),h.classList.remove("hidden")})(e),k.noUiSlider.on("update",(({filterName:e,unit:t})=>(r,o)=>{T.value=r[o],q.style.filter=`${e}(${T.value}${t})`})(e))})(t)};A.forEach((e=>{var t;e.addEventListener("change",(t=e.value,()=>{C(),t===g.ORIGINAL.FILTER?U():x(t)}))}));const N=document.querySelector(".img-upload__form").querySelector(".text__hashtags"),b=(e,t)=>{for(const r of t)if(!e(r))return!1;return!0},w=e=>"#"===e[0],F=e=>e.length>1,M=e=>n(e,20),R=e=>-1===(e=>e.slice(1))(e).search(/[\p{P}\p{S}]/u),D=new Map([[e=>b(w,e),"Хештег должен начинаться с #"],[e=>b(F,e),"Добавьте текст хештега после символа #"],[e=>b(R,e),"Хештег может содержать только буквы и цифры"],[e=>b(M,e),"В хештеге количество символов (включая #) не должно быть больше 20"],[e=>{const t=[];for(const r of e){const e=r.toLowerCase();if(t.includes(e))return!1;t.push(e)}return!0},"Хештеги не должны повторяться"],[e=>e.length<=5,"Хештегов не должно быть больше 5"]]);N.addEventListener("change",(()=>{const e=N.value;if(""===e.trim())return void(N.validity.customError&&K(N));const t=e.trim().split(/[\s]+/);for(const[e,r]of D.entries()){if(!e(t))return void J(N,r,j);K(N)}}));const V=document.querySelector(".img-upload__form").querySelector(".text__description");V.maxLength=140;V.addEventListener("input",(()=>{(e=>n(e,140))(V.value)?K(V):J(V,"Максимальная количество символов в комментарии — 140",j)}));const P=document.querySelector("#upload-submit");let $;const O=["jpg","jpeg","png"],j="3px red solid",X=document.querySelector("#upload-select-image"),G=X.querySelector("#upload-file"),H=X.querySelector(".img-upload__overlay"),B=H.querySelector("#upload-cancel"),W=document.querySelector("main"),z=()=>{G.value=null},J=(e,t,r)=>{e.style.border=r,e.setCustomValidity(t),e.reportValidity()},K=e=>J(e,"",null),Q=e=>e.target===N||e.target===V,Y=()=>{f=1,L(f),C(),U(),A[0].checked=!0,z(),r("img/upload-default-image.jpg"),K(N),K(V),s(N),s(V)},Z=e=>{e.stopPropagation()};let ee;const te=e=>{e.remove(),document.removeEventListener("keydown",ee)},re=e=>()=>{u(H,B,"upload");const t=document.querySelector(`#${e}`).content.querySelector(`.${e}`).cloneNode(!0),r=t.querySelector(`.${e}__inner`),o=t.querySelector(`.${e}__button`);ee=(e=>t=>{c(t)&&(t.preventDefault(),te(e))})(t),o.addEventListener("click",(e=>()=>{te(e)})(t)),t.addEventListener("click",(e=>()=>{te(e)})(t)),r.addEventListener("click",Z),document.addEventListener("keydown",ee),W.appendChild(t)};G.addEventListener("input",(()=>{const e=G.files[0],o=e.name.toLowerCase();if(n=o,!O.some((e=>n.endsWith(`.${e}`))))return l("Выбран неподходящий файл",1500),void z();var n,c;(()=>{const e=t.cloneNode(!0);document.body.appendChild(e)})(),(c=e,new Promise((e=>{const t=new FileReader;t.addEventListener("load",(()=>{r(t.result),e()})),t.readAsDataURL(c)}))).then((()=>{document.querySelector(".img-upload__message").remove(),d(H,B,"upload")}))})),X.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(X);((e,t,r)=>{$=P.textContent,P.textContent="Отправка...",P.disabled=!0,fetch("https://22.javascript.pages.academy/kekstagram",{method:"POST",body:r}).then((t=>{if(!t.ok)throw new Error("Ошибка загрузки файла");e()})).catch((()=>{t()})).finally((()=>{P.textContent=$,P.disabled=!1}))})(re("success"),re("error"),t)}));const oe=document.querySelector(".social__comments"),ne=document.querySelector("#comment").content.querySelector(".social__comment"),ce=document.querySelector(".comments-loader"),le=document.querySelector(".shown-comments-count");let se=0;const ie=({avatar:e,message:t,name:r})=>{const o=ne.cloneNode(!0),n=o.querySelector(".social__picture"),c=o.querySelector(".social__text");return n.src=e,n.alt=r,c.textContent=t,o};let ae;const de=()=>{ce.classList.add("hidden"),ce.removeEventListener("click",ae)},ue=e=>{const t=(r=e,Math.min(5,r.length));var r;const o=document.createDocumentFragment();for(let r=0;r<t;r++)o.appendChild(ie(e.shift())),se++;oe.appendChild(o),le.textContent=se},me=document.querySelector(".big-picture"),pe=me.querySelector("#picture-cancel"),ye=me.querySelector(".big-picture__img img"),ve=me.querySelector(".social__caption"),Se=me.querySelector(".likes-count"),_e=me.querySelector(".comments-count"),fe=e=>{document.querySelectorAll(".picture").forEach(((t,r)=>{t.addEventListener("click",(()=>{d(me,pe),(({url:e,likes:t,comments:r,description:o})=>{ye.src=e,Se.textContent=t,_e.textContent=r.length,ve.textContent=o})(e[r]),de(),(()=>{for(;oe.firstChild;)oe.firstChild.remove();se=0})(),(e=>{const t=e.slice(),r=t.length;0!==r&&(ue(t),r>5&&(ae=(e=>()=>{ue(e),0===e.length&&de()})(t),ce.classList.remove("hidden"),ce.addEventListener("click",ae)))})(e[r].comments)}))}))},Le=document.querySelector(".pictures"),ge=document.querySelector("#picture").content.querySelector(".picture"),Ee=e=>{const t=document.createDocumentFragment();e.forEach((({url:e,likes:r,comments:o})=>{const n=ge.cloneNode(!0);n.querySelector(".picture__img").src=e,n.querySelector(".picture__likes").textContent=r,n.querySelector(".picture__comments").textContent=o.length,t.appendChild(n)})),Le.appendChild(t)},qe=e=>{Le.querySelectorAll(".picture").forEach((e=>{e.remove()})),Ee(e),fe(e)},he=document.querySelector(".img-filters"),ke="img-filters__button--active",Ae=e=>e.comments.length,Te=(e,t)=>{const r=Ae(e);return Ae(t)-r},Ie={default:e=>{qe(e)},random:e=>{const t=_.shuffle(e.slice()).slice(0,10);qe(t)},discussed:e=>{const t=e.slice().sort(Te);qe(t)}};let Ue=Object.keys(Ie)[0];const Ce=e=>`#filter-${e}`,xe=(e,t)=>{document.querySelector(Ce(Ue)).classList.remove(ke),Ue=t,e.classList.add(ke)};var Ne;Ne=e=>{Ee(e),fe(e),he.classList.remove("img-filters--inactive"),(e=>{for(const t of Object.keys(Ie)){const r=document.querySelector(Ce(t));r.addEventListener("click",(o=>{r.classList.contains(ke)||(o.preventDefault(),xe(r,t),e(t))}))}})(_.debounce((t=>((e,t)=>Ie[e](t))(t,e)),500))},fetch("https://22.javascript.pages.academy/kekstagram/data").then((e=>{if(e.ok)return e.json();throw new Error("Ошибка загрузки изображений")})).then((e=>{Ne(e)})).catch((e=>{l(e.message)}))})();
//# sourceMappingURL=main.bundle.js.map